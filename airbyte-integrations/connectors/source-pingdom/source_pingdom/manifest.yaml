version: "0.29.0"

definitions:
  requester:
    type: HttpRequester
    url_base: "https://api.pingdom.com/api/3.1"
    http_method: "GET"
    authenticator:
      type: BearerAuthenticator
      api_token: "{{ config['api_key'] }}"

  credits_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path: ["credits"]
      paginator:
        type: NoPagination
      requester:
        $ref: "#/definitions/requester"
    name: "credits"
    $parameters:
      path: "/credits"
  
  probes_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path: ["probes"]
      paginator:
        type: NoPagination
      requester:
        $ref: "#/definitions/requester"
    name: "probes"
    $parameters:
      path: "/probes"

  maintenance_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path: ["maintenance"]
      paginator:
        type: NoPagination
      requester:
        $ref: "#/definitions/requester"
    name: "maintenance"
    $parameters:
      path: "/maintenance"

  maintenance_occurrences_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path: ["occurrences"]
      paginator:
        type: NoPagination
      requester:
        $ref: "#/definitions/requester"
    name: "maintenance_occurrences"
    $parameters:
      path: "/maintenance.occurrences"
  
  reference_regions_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path: ["regions"]
      paginator:
        type: NoPagination
      requester:
        $ref: "#/definitions/requester"
    name: "reference_regions"
    $parameters:
      path: "/reference"

  reference_timezones_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path: ["timezones"]
      paginator:
        type: NoPagination
      requester:
        $ref: "#/definitions/requester"
    name: "reference_timezones"
    $parameters:
      path: "/reference"

  reference_datetimeformats_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path: ["datetimeformats"]
      paginator:
        type: NoPagination
      requester:
        $ref: "#/definitions/requester"
    name: "reference_datetimeformats"
    $parameters:
      path: "/reference"

  reference_numberformats_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path: ["numberformats"]
      paginator:
        type: NoPagination
      requester:
        $ref: "#/definitions/requester"
    name: "reference_numberformats"
    $parameters:
      path: "/reference"

  reference_countries_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path: ["countries"]
      paginator:
        type: NoPagination
      requester:
        $ref: "#/definitions/requester"
    name: "reference_countries"
    $parameters:
      path: "/reference"

  reference_phonecodes_stream:
    type: DeclarativeStream
    retriever:
      type: SimpleRetriever
      record_selector:
        type: RecordSelector
        extractor:
          type: DpathExtractor
          field_path: ["phonecodes"]
      paginator:
        type: NoPagination
      requester:
        $ref: "#/definitions/requester"
    name: "reference_phonecodes"
    $parameters:
      path: "/reference"

streams:
  - "#/definitions/credits_stream"
  - "#/definitions/probes_stream"
  - "#/definitions/maintenance_stream"
  - "#/definitions/maintenance_occurrences_stream"
  - "#/definitions/reference_regions_stream"
  - "#/definitions/reference_timezones_stream"
  - "#/definitions/reference_datetimeformats_stream"
  - "#/definitions/reference_numberformats_stream"
  - "#/definitions/reference_countries_stream"
  - "#/definitions/reference_phonecodes_stream"

check:
  type: CheckStream
  stream_names:
    - "credits"
    - "probes"
    - "maintenance"
    - "maintenance_occurrences"
    - "reference_regions"
    - "reference_timezones"
    - "reference_datetimeformats"
    - "reference_numberformats"
    - "reference_countries"
    - "reference_phonecodes"

